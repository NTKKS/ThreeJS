<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js App</title>
    <link rel="stylesheet" href="css/main.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

</head>

<body class="text-center" id="container">

    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="masthead mb-auto">
            <div class="inner">
                <h3 class="masthead-brand">Cover</h3>
                <nav class="nav nav-masthead justify-content-center">
                    <a class="nav-link active" href="#">Home</a>
                    <a class="nav-link" href="#">Features</a>
                    <a class="nav-link" href="#">Contact</a>
                </nav>
            </div>
        </header>

        <main role="main" class="inner cover">
            <h1 class="cover-heading">Virtuální prohlídka FIM</h1>
            <p class="lead">Prohlédněte si svoji milovanou fakultu.</p>
            <p class="lead">
                <p>
                    <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button"
                        aria-expanded="false" aria-controls="collapseExample">
                        Zobrazit / Skrýt mapu
                    </a>
                </p>
                <div class="collapse" id="collapseExample">
                    <div class="card card-body" style="margin: auto;">
                        <img src="img\1np.jpg" class="img-fluid" alt="1np">
                    </div>
                </div>
            </p>
        </main>

        <footer class="mastfoot mt-auto">
            <div class="inner">
                <p>Footer info</p>
            </div>
        </footer>
    </div>

    <script src="js/three.js"></script>

    <script>
        var camera, renderer, scene, cube, geometry, plane, container, material, width, height, aspect;

        var buttons = document.getElementsByTagName("button");
        for (let i = 0; i < buttons.length; i++) {
            buttons[i].addEventListener("click", onButtonClick, false);
        };

        function onButtonClick(event) {
            alert(event.target.id);
        }

        var isUserInteracting = false,
            onPointerDownMouseX = 0,
            onPointerDownMouseY = 0,
            lon = 0,
            onPointerDownLon = 0,
            lat = 0,
            onPointerDownLat = 0,
            phi = 0,
            theta = 0;

        init();

        function createCamera() {
            // Create a Camera
            width = window.innerWidth;
            height = window.innerHeight;
            aspect = width / height;
            const fov = 75; // Field of View
            const near = 1; // the near clipping plane
            const far = 1100; // the far clipping plane

            camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
            //camera.position.z = 5;
            camera.target = new THREE.Vector3(0, 0, 0);
        }

        /* function createLights() {
            // Create a point light
            const light = new THREE.PointLight(0xff0000, 1, 30);
            light.position.set(5, 5, 5);
            scene.add(light);
        } */

        function createObjects() {
            geometry = new THREE.SphereBufferGeometry(500, 60, 40);
            // invert the geometry on the x-axis so that all of the faces point inward
            geometry.scale(-1, 1, 1);

            var texture = new THREE.TextureLoader().load('img/koleje.jpg');
            var material = new THREE.MeshBasicMaterial({
                map: texture
            });

            mesh = new THREE.Mesh(geometry, material);

            scene.add(mesh);
        }

        function createRenderer() {
            container = document.getElementById('container');

            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            //document.body.appendChild(renderer.domElement);
            container.appendChild(renderer.domElement);

            container.style.touchAction = 'none';
            container.addEventListener('pointerdown', onPointerDown, false);

            document.addEventListener('wheel', onDocumentMouseWheel, false);
        }

        function init() {

            scene = new THREE.Scene();
            createCamera();
            //createLights();
            createObjects();
            createRenderer();
            animate();
        }

        window.addEventListener('resize', onWindowResize, false);

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function onPointerDown(event) {

            if (event.isPrimary === false) return;

            isUserInteracting = true;

            onPointerDownMouseX = event.clientX;
            onPointerDownMouseY = event.clientY;

            onPointerDownLon = lon;
            onPointerDownLat = lat;

            document.addEventListener('pointermove', onPointerMove, false);
            document.addEventListener('pointerup', onPointerUp, false);

        }

        function onPointerMove(event) {

            if (event.isPrimary === false) return;

            lon = (onPointerDownMouseX - event.clientX) * 0.1 + onPointerDownLon;
            lat = (event.clientY - onPointerDownMouseY) * 0.1 + onPointerDownLat;

        }

        function onPointerUp() {

            if (event.isPrimary === false) return;

            isUserInteracting = false;

            document.removeEventListener('pointermove', onPointerMove);
            document.removeEventListener('pointerup', onPointerUp);

        }

        function onDocumentMouseWheel(event) {

            var fov = camera.fov + event.deltaY * 0.05;

            camera.fov = THREE.MathUtils.clamp(fov, 10, 120);

            camera.updateProjectionMatrix();

        }

        function animate() {
            requestAnimationFrame(animate);
            update()
        };

        function update() {

            if (isUserInteracting === false) {

                lon += 0.1;

            }

            lat = Math.max(-85, Math.min(85, lat));
            phi = THREE.MathUtils.degToRad(90 - lat);
            theta = THREE.MathUtils.degToRad(lon);

            camera.target.x = 500 * Math.sin(phi) * Math.cos(theta);
            camera.target.y = 500 * Math.cos(phi);
            camera.target.z = 500 * Math.sin(phi) * Math.sin(theta);

            camera.lookAt(camera.target);

            renderer.render(scene, camera);

        }
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous">
    </script>

</body>

</html>